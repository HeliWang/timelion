<div timelion-app class="timelion app-container" ng-controller="timelion">
  <navbar class="timelion-nav">
    <div class="timelion-stats">
      <strong>Deduplication</strong> {{((1 - (stats.cacheCount/stats.queryCount))*100) | number:0}}% /
      <strong>Query Time</strong> {{stats.queryTime - stats.invokeTime}}ms /
      <strong>Processing Time</strong> {{stats.sheetTime - stats.queryTime}}ms
    </div>

    <div class="timelion-actions button-group" role="toolbar">
      <button
        aria-label="Add Chart"
        ng-click="newCell()">
        <span>+ Chart</span>
      </button>
      <button
        ng-click="configTemplate.toggle('save');"
        ng-class="{active: configTemplate.is('save')}"
        aria-haspopup="true"
        aria-expanded="{{ configTemplate.is('save') }}"
        aria-label="Save Sheet">
        <span>Save</span>
      </button>
      <button
        aria-haspopup="true"
        aria-expanded="{{ configTemplate.is('load') }}"
        ng-click="configTemplate.toggle('load');"
        ng-class="{active: configTemplate.is('load')}"
        aria-label="Load Saved Sheet">
        <span>Open</span>
      </button>
      <button
        ng-click="configTemplate.toggle('options');"
        ng-class="{active: configTemplate.is('options')}"
        aria-haspopup="true"
        aria-expanded="{{ configTemplate.is('options') }}"
        aria-label="Sheet Options">
        <span>Options</span>
      </button>
      <button
        ng-click="newSheet()"
        aria-label="New Sheet">
        <span>Clear</span>
      </button>
      <button
        aria-label="Show Help"
        ng-click="configTemplate.toggle('docs');">
        <span>Help</span>
      </button>
      <div class="chrome-actions" kbn-chrome-append-nav-controls></div>
    </div>
  </navbar>
  <config
    config-template="configTemplate"
    config-object="opts"
    config-close="configClose">
  </config>

  <navbar class="timelion-navbar" scroll-class="timelion-scroll-class-header" scroll-limit=45>
    <form role="form" class="fill inline-form" ng-submit="search()" name="discoverSearch">
      <div class="typeahead">
        <div class="input-group"
          ng-class="discoverSearch.$invalid ? 'has-error' : ''">
          <input input-focus
            ng-model="state.sheet[state.selected]"
            timelion-expression="{{state.sheet[state.selected]}}"
            placeholder="Expression ..."
            aria-label="Expression input"
            type="text"
            class="form-control timelion-expression">

          <input input-focus ng-if="state.interval === 'other'"
            class="form-control timelion-interval"
            ng-model="state.otherInterval">

          <select class="form-control timelion-interval"
            ng-options="i for i in ['1s', '1m', '1h', '1d', '1w', '1M', '1y', 'other']"
            ng-class="{'timelion-interval-other': state.interval == 'other'}"
            ng-model="state.interval"></select>

          <button type="submit"
            ng-disabled="discoverSearch.$invalid"
            aria-label="Search">
            <span aria-hidden="true" class="fa fa-play"></span></button>
        </div>
      </div>
    </form>
  </navbar>

  <div class="timelion-container" scroll-class="timelion-scroll-class-body" scroll-limit=45>
    <div class="timelion-container-sheet">
      <div class="timelion-container-sheet-margin"
        sv-root sv-part="state.sheet"
        sv-on-sort="drop($item, $partFrom, $partTo, $indexFrom, $indexTo)">
        <div class="chart-container col-md-{{12 / state.columns}} col-sm-12 col-xs-12" sv-element
          timelion-grid timelion-grid-rows="state.rows"
          ng-repeat="cell in state.sheet track by $index"
          ng-click="setActiveCell($index)"
          ng-class="{active: $index === state.selected}"
          >
          <div chart="sheet[$index]" search="search"></div>
          <div class="cell-actions">
            <div class="cell-id" ng-click="removeCell($index)" tooltip="Remove" tooltip-append-to-body="1"><span>{{$index + 1}}</span></div>
            <div class="cell-move" tooltip="Drag to reorder" tooltip-append-to-body="1" sv-handle><span class="fa fa-arrows"></span></div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
